{"title":"Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}","markdown":{"yaml":{"title":"Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}","subtitle":"**[Chapitre 2: manipuler des donn√©es structur√©es]{.orange}**\n","authors":"[Lino Galiana](https://www.linogaliana.fr/),\n","slide-number":true,"header":"[Retour √† la page principale du cours](https://rgeo.linogaliana.fr/)\n","footer":"Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}, √âcole Normale Sup√©rieure ([retour page principale](/))\n","lang":"fr-FR","slide-tone":false,"chalkboard":{"theme":"whiteboard"},"format":"onyxia-revealjs","controls":true,"css":"custom.css","from":"markdown+emoji","listing":{"id":"sample-listings","contents":"teaching","sort":"date desc","type":"table"}},"headingText":"Chapitre introductif","containsRefs":false,"markdown":"\n\n\n::: {.callout-note}\n- Exercices associ√©s √† ce chapitre [ici](/exercises/r-wrangling.html)\n:::\n\n![](../cards/wrangling/kidmatrix.png){fig-align=\"center\"}\n\n- [Retour √† la page principale](/)\n\n## Introduction\n\n- {{< fa brands r-project >}} centr√© autour du _dataframe_ \n\n. . .\n\n- Mais manipulations parfois un peu lourdes :\n    - `df$var`: un peu lourd\n    - `df[,]`: un peu trop calqu√© sur les matrices\n\n. . . \n\n- Donn√©es textuelles: une base perfectible\n    - Des _outputs_ alambiqu√©s\n    - Des fonctionnalit√©s manquantes par rapport √† `Python`\n    \n## La r√©ponse: le `tidyverse` !\n\n![L'√©cosyst√®me du [`tidyverse`](https://www.tidyverse.org/)](./img/tidyverse.png)\n\n## La r√©ponse: le `tidyverse` !\n\nUn ensemble de _packages_ d√©velopp√©s par `RStudio` qui facilite :\n\n- La lecture (`readr`) et la manipulation de bases de donn√©es (`dplyr`)\n- L'exploitation de donn√©es textuelles (`stringr`), temporelles (`lubridate`)\nou cat√©gorielles (`forcats`)\n- La cr√©ation de graphiques (`ggplot2`)\n- La programmation √† partir de _dataframes_ (`purrr`)\n- Et bien d'autres choses...\n\n## Le concept de donn√©es _tidy_\n\n\n- Chaque variable poss√®de sa propre colonne ;\n- Chaque observation poss√®de sa propre ligne ;\n- Une valeur, mat√©rialisant une observation d‚Äôune variable, se trouve sur une unique cellule.\n\n::: {.callout-note}\nConcept popularis√© par Hadley Wickham.\n:::\n\n## `readr`\n\n![](https://readr.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ pour lire des fichiers plats (`.csv`, `.txt`...)\n- Permet d'obtenir un `tibble`, le _dataframe_ augment√© du `tidyverse`\n\n## `dplyr` \n\n![](https://dplyr.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ central de l'√©cosyst√®me de manipulation de donn√©es ;\n- Manipulation de donn√©es et statistiques descriptives ;\n\n## `dplyr` {.smaller}\n\n### Principaux verbes\n\nOn travaille sur un `tibble` (_dataframe_ augment√©)\n\n- `select()` : s√©lectionner des variables par leur nom ;\n- `rename()` : renommer des variables ;\n- `filter()` : s√©lectionner des observations selon une ou plusieurs conditions ;\n- `arrange()` : trier la table selon une ou plusieurs variables ;\n- `mutate()` : ajouter des variables qui sont fonction d‚Äôautres variables ;\n- `summarise()` : calculer une statistique √† partir de donn√©es ;\n- `group_by()` : faire des op√©rations par groupe.- `\n\n\n\n## `dplyr` {.smaller}\n\n### Manipulation de donn√©es\n\nOn enchaine des s√©quences avec les  _pipe_ (`%>%`)\n```{r}\n#| eval: false\n#| echo: true\nlibrary(doremifasol)\nlibrary(dplyr)\n\nbase_publique_equipements <- telechargerDonnees(\"BPE_ENS\")\nbase_publique_equipements %>%\n  as_tibble() %>% # <1>\n  filter(TYPEQU == \"B316\") %>% # <2>\n  mutate(x = paste0(AN, \"_\", NB_EQUIP)) # <3>\n```\n1. On convertit le _dataframe_ standard en `tibble`\n2. On ne garde que les stations services (valeurs `B316` de `TYPEQU`)\n3. On cr√©e une nouvelle colonne en faisant r√©f√©rence √† celles existantes (sans guillemets!)\n\n<br>\n\n::: {.callout-note}\nPlus de d√©tails dans [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_tidyverse)\n:::\n\n## `dplyr` {.smaller}\n\n### Statistiques agr√©g√©es\n\n- Logique du _split-apply-combine_ avec `groupby`\n\n<details>\n<summary>\nIllustration du _split-apply-combine_\n</summary>\n![](https://miro.medium.com/v2/resize:fit:1400/1*w2oGdXv5btEMxAkAsz8fbg.png)\n</details>\n\n```{r}\n#| eval: false\n#| echo: true\nlibrary(doremifasol)\nlibrary(dplyr)\n\nbase_publique_equipements <- telechargerDonnees(\"BPE_ENS\")\nbase_publique_equipements %>%\n  as_tibble() %>% # <1>\n  filter(TYPEQU == \"B316\") %>% # <2>\n  group_by(DEP) %>% # <3>\n  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE))  # <4>\n```\n1. On convertit le _dataframe_ standard en `tibble`\n2. On ne garde que les stations services (valeurs `B316` de `TYPEQU`)\n3. On d√©finit `DEP` comme une variable de stratification pour d√©finir des groupes\n4. On r√©sume les donn√©es en faisant la somme des stations services dans chaque groupe\n\n## `ggplot`\n\n![](https://ggplot2.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ indispensable pour faire des graphiques ‚ù§Ô∏è ;\n- Approche coh√©rente et flexible bas√©e sur la __grammaire des graphiques__\n    + Objet d'un chapitre d√©di√©\n\n## `stringr`, `forcats` et `lubridate`\n\n:::{ncol-layout=3 fig-align=\"center\"}\n![](https://stringr.tidyverse.org/logo.png){width=20%}\n![](https://forcats.tidyverse.org/logo.png){width=20%}\n![](https://lubridate.tidyverse.org/logo.png){width=20%}\n:::\n\n- Plein de fonctions facilitant la manipulation:\n    - Donn√©es textuelles: `stringr`\n    - Donn√©es cat√©gorielles: `forcats`\n    - Donn√©es temporelles: `lubridate`\n\n# Les formats de donn√©es\n\n## G√©n√©ralit√©s\n\n- Donn√©es peuvent √™tre stock√©es dans de nombreux formats diff√©rents\n    + Standards diff√©rents\n    + Mani√®res d'importer diff√©rentes\n\n. . .\n\n- Fonctionnalit√©s de {{< fa brands r-project >}} limit√©es:\n    + Packages sp√©cialis√©s pour certains formats\n    + Objectif: applatir l'information dans un _dataframe_\n\n::: {.callout-note}\nOn verra les formats g√©ographiques, et leurs enjeux, ult√©rieurement\n:::\n\n## Le `CSV`\n\n- Format de fichier plat avec des colonnes d√©limit√©es:\n    + Standard: `,` en d√©limitateur, `.` en d√©cimale ;\n    + Variante europ√©enne üòÆ‚Äçüí®: `;` en d√©limitateur, `,` en d√©cimale\n\n- Format universel, simple d'utilisation (quelques limites)\n\n\n```{ojs}\nviewof info_csv = Inputs.radio(\n  [\"Fichier brut\", \"Ficher apr√®s import\"], {value: \"Fichier brut\"}\n)\n```\n\n```{ojs}\ninfo_csv == \"Fichier brut\" ? html`<div>${md_csv}<div>` : html`<div>${df_csv}<div>`\n```\n\n\n\n```{ojs}\n//| output: false\ndf_csv = Inputs.table(\n  d3.csvParse(raw_csv)\n)\nmd_csv = md`\n\\`\\`\\`\n${raw_csv}\n\\`\\`\\`\n`\n```\n\n```{ojs}\n//| output: false\nraw_csv = `DEP,REG,CHEFLIEU,TNCC,NCC,NCCENR,LIBELLE\n01,84,01053,5,AIN,Ain,Ain\n02,32,02408,5,AISNE,Aisne,Aisne\n03,84,03190,5,ALLIER,Allier,Allier\n04,93,04070,4,ALPES DE HAUTE PROVENCE,Alpes-de-Haute-Provence,Alpes-de-Haute-Provence\n05,93,05061,4,HAUTES ALPES,Hautes-Alpes,Hautes-Alpes\n06,93,06088,4,ALPES MARITIMES,Alpes-Maritimes,Alpes-Maritimes\n`\n```\n\n## Le `CSV`\n\n- Lecture avec la fonction `read_csv` du package `readr`!\n\n```{r}\n#| eval: false\n#| echo: true\nlibrary(readr) # <1>\nread_csv(\"dossier_donnees/nom_fichier.csv\") # <2>\n```\n1. On importe la librairie `readr` pour avoir acc√®s √† la fonction `read_csv`\n2. On utilise `read_csv` pour lire les donn√©es stock√©es dans le chemin relatif\n`dossier_donnees/nom_fichier.csv`\n\n\n:::{.callout-note}\n- CSV avec d√©limitateur `;`: fonction `read_csv2`. \n- Formats plats plus exotiques (`.txt` par exemple): `read_delim`\n\nPlus de d√©tails dans la documentation [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats#importer-un-fichier-avec-le-package-readr)\n:::\n\n## Le `JSON`\n\n- Le format du _web_, notamment des API \n    + API: on verra √ßa plus tard\n\n```{ojs}\nviewof info_json = Inputs.radio(\n  [\"Fichier brut\", \"Ficher apr√®s import\"], {value: \"Fichier brut\"}\n)\n```\n\n```{ojs}\ninfo_json == \"Fichier brut\" ? html`<div>${md_json}<div>` : html`<div>${df_json}<div>`\n```\n\n```{ojs}\n//| output: false\njson_string = `[\n  {\"DEP\": \"01\", \"REG\": \"84\", \"CHEFLIEU\": \"01053\", \"TNCC\": \"5\", \"NCC\": \"AIN\", \"NCCENR\": \"Ain\", \"LIBELLE\": \"Ain\"},\n  {\"DEP\": \"02\", \"REG\": \"32\", \"CHEFLIEU\": \"02408\", \"TNCC\": \"5\", \"NCC\": \"AISNE\", \"NCCENR\": \"Aisne\", \"LIBELLE\": \"Aisne\"},\n  {\"DEP\": \"03\", \"REG\": \"84\", \"CHEFLIEU\": \"03190\", \"TNCC\": \"5\", \"NCC\": \"ALLIER\", \"NCCENR\": \"Allier\", \"LIBELLE\": \"Allier\"},\n  {\"DEP\": \"04\", \"REG\": \"93\", \"CHEFLIEU\": \"04070\", \"TNCC\": \"4\", \"NCC\": \"ALPES DE HAUTE PROVENCE\", \"NCCENR\": \"Alpes-de-Haute-Provence\", \"LIBELLE\": \"Alpes-de-Haute-Provence\"},\n  {\"DEP\": \"05\", \"REG\": \"93\", \"CHEFLIEU\": \"05061\", \"TNCC\": \"4\", \"NCC\": \"HAUTES ALPES\", \"NCCENR\": \"Hautes-Alpes\", \"LIBELLE\": \"Hautes-Alpes\"},\n  {\"DEP\": \"06\", \"REG\": \"93\", \"CHEFLIEU\": \"06088\", \"TNCC\": \"4\", \"NCC\": \"ALPES MARITIMES\", \"NCCENR\": \"Alpes-Maritimes\", \"LIBELLE\": \"Alpes-Maritimes\"}\n]`\nraw_json = [\n  {\"DEP\": \"01\", \"REG\": \"84\", \"CHEFLIEU\": \"01053\", \"TNCC\": \"5\", \"NCC\": \"AIN\", \"NCCENR\": \"Ain\", \"LIBELLE\": \"Ain\"},\n  {\"DEP\": \"02\", \"REG\": \"32\", \"CHEFLIEU\": \"02408\", \"TNCC\": \"5\", \"NCC\": \"AISNE\", \"NCCENR\": \"Aisne\", \"LIBELLE\": \"Aisne\"},\n  {\"DEP\": \"03\", \"REG\": \"84\", \"CHEFLIEU\": \"03190\", \"TNCC\": \"5\", \"NCC\": \"ALLIER\", \"NCCENR\": \"Allier\", \"LIBELLE\": \"Allier\"},\n  {\"DEP\": \"04\", \"REG\": \"93\", \"CHEFLIEU\": \"04070\", \"TNCC\": \"4\", \"NCC\": \"ALPES DE HAUTE PROVENCE\", \"NCCENR\": \"Alpes-de-Haute-Provence\", \"LIBELLE\": \"Alpes-de-Haute-Provence\"},\n  {\"DEP\": \"05\", \"REG\": \"93\", \"CHEFLIEU\": \"05061\", \"TNCC\": \"4\", \"NCC\": \"HAUTES ALPES\", \"NCCENR\": \"Hautes-Alpes\", \"LIBELLE\": \"Hautes-Alpes\"},\n  {\"DEP\": \"06\", \"REG\": \"93\", \"CHEFLIEU\": \"06088\", \"TNCC\": \"4\", \"NCC\": \"ALPES MARITIMES\", \"NCCENR\": \"Alpes-Maritimes\", \"LIBELLE\": \"Alpes-Maritimes\"}\n]\nmd_json = md`\n\\`\\`\\`\n${json_string}\n\\`\\`\\`\n`\n```\n\n```{ojs}\n//| output: false\ndf_json = Inputs.table(raw_json)\n```\n\n## Le `JSON`\n\n- Import√© comme une liste hi√©rarchis√©e\n- Objectif: transformer cette information dans un _dataframe_ `tidy`\n    + Pas toujours √©vident !\n\n```{r}\n#| eval: false\n#| echo: true\nlibrary(jsonlite) # <1>\ndf <- fromJSON(file=\"dossier_donnees/nom_fichier.json\") # <2>\n```\n1. On importe la librairie `jsonlite` pour avoir acc√®s √† la fonction `fromJSON`\n2. On utilise `fromJSON` pour lire les donn√©es stock√©es dans le chemin relatif\n`dossier_donnees/nom_fichier.csv`\n\n\n## Les formats Excel\n\n{{< iconify face-vomiting size=10x >}}\n\n## Les formats Excel\n\n- Format propri√©taire\n\n- M√©lange mise en forme et donn√©es brute\n    + Pas appropri√© pour l'analyse de donn√©es\n    + Dangereux pour la reproductibilit√© et la transparence\n\n- Plus de d√©tails sur [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_tableurs)\n\n# Le _pipe_ `magrittr` (`%>%`)\n\n## Le _pipe_ `magrittr` (`%>%`)\n\n\nUne mani√®re de cha√Æner les op√©rations\n\n![](https://magrittr.tidyverse.org/logo.png){width=20%}\n\n::: {.panel-tabset}\n\n## Fonctions emboit√©es\n\n```\nlibrary(dplyr)\nlibrary(doremifasol)\n\ndf <- filter(\n  as_tibble(telechargerDonnees(\"BPE_ENS\")),\n  TYPEQU == \"B316\"\n)\n\nsummarise(\n  group_by(df, DEP),\n  nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)\n)\n```  \n\n\n## Avec le _pipe_\n\n```\nlibrary(dplyr)\nlibrary(doremifasol)\n\ntelechargerDonnees(\"BPE_ENS\") %>%\n  as_tibble() %>%\n  filter(TYPEQU == \"B316\") %>% \n  group_by(DEP) %>% \n  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)) \n```  \n\n\n:::\n","srcMarkdownNoYaml":"\n\n## Chapitre introductif\n\n::: {.callout-note}\n- Exercices associ√©s √† ce chapitre [ici](/exercises/r-wrangling.html)\n:::\n\n![](../cards/wrangling/kidmatrix.png){fig-align=\"center\"}\n\n- [Retour √† la page principale](/)\n\n## Introduction\n\n- {{< fa brands r-project >}} centr√© autour du _dataframe_ \n\n. . .\n\n- Mais manipulations parfois un peu lourdes :\n    - `df$var`: un peu lourd\n    - `df[,]`: un peu trop calqu√© sur les matrices\n\n. . . \n\n- Donn√©es textuelles: une base perfectible\n    - Des _outputs_ alambiqu√©s\n    - Des fonctionnalit√©s manquantes par rapport √† `Python`\n    \n## La r√©ponse: le `tidyverse` !\n\n![L'√©cosyst√®me du [`tidyverse`](https://www.tidyverse.org/)](./img/tidyverse.png)\n\n## La r√©ponse: le `tidyverse` !\n\nUn ensemble de _packages_ d√©velopp√©s par `RStudio` qui facilite :\n\n- La lecture (`readr`) et la manipulation de bases de donn√©es (`dplyr`)\n- L'exploitation de donn√©es textuelles (`stringr`), temporelles (`lubridate`)\nou cat√©gorielles (`forcats`)\n- La cr√©ation de graphiques (`ggplot2`)\n- La programmation √† partir de _dataframes_ (`purrr`)\n- Et bien d'autres choses...\n\n## Le concept de donn√©es _tidy_\n\n\n- Chaque variable poss√®de sa propre colonne ;\n- Chaque observation poss√®de sa propre ligne ;\n- Une valeur, mat√©rialisant une observation d‚Äôune variable, se trouve sur une unique cellule.\n\n::: {.callout-note}\nConcept popularis√© par Hadley Wickham.\n:::\n\n## `readr`\n\n![](https://readr.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ pour lire des fichiers plats (`.csv`, `.txt`...)\n- Permet d'obtenir un `tibble`, le _dataframe_ augment√© du `tidyverse`\n\n## `dplyr` \n\n![](https://dplyr.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ central de l'√©cosyst√®me de manipulation de donn√©es ;\n- Manipulation de donn√©es et statistiques descriptives ;\n\n## `dplyr` {.smaller}\n\n### Principaux verbes\n\nOn travaille sur un `tibble` (_dataframe_ augment√©)\n\n- `select()` : s√©lectionner des variables par leur nom ;\n- `rename()` : renommer des variables ;\n- `filter()` : s√©lectionner des observations selon une ou plusieurs conditions ;\n- `arrange()` : trier la table selon une ou plusieurs variables ;\n- `mutate()` : ajouter des variables qui sont fonction d‚Äôautres variables ;\n- `summarise()` : calculer une statistique √† partir de donn√©es ;\n- `group_by()` : faire des op√©rations par groupe.- `\n\n\n\n## `dplyr` {.smaller}\n\n### Manipulation de donn√©es\n\nOn enchaine des s√©quences avec les  _pipe_ (`%>%`)\n```{r}\n#| eval: false\n#| echo: true\nlibrary(doremifasol)\nlibrary(dplyr)\n\nbase_publique_equipements <- telechargerDonnees(\"BPE_ENS\")\nbase_publique_equipements %>%\n  as_tibble() %>% # <1>\n  filter(TYPEQU == \"B316\") %>% # <2>\n  mutate(x = paste0(AN, \"_\", NB_EQUIP)) # <3>\n```\n1. On convertit le _dataframe_ standard en `tibble`\n2. On ne garde que les stations services (valeurs `B316` de `TYPEQU`)\n3. On cr√©e une nouvelle colonne en faisant r√©f√©rence √† celles existantes (sans guillemets!)\n\n<br>\n\n::: {.callout-note}\nPlus de d√©tails dans [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_tidyverse)\n:::\n\n## `dplyr` {.smaller}\n\n### Statistiques agr√©g√©es\n\n- Logique du _split-apply-combine_ avec `groupby`\n\n<details>\n<summary>\nIllustration du _split-apply-combine_\n</summary>\n![](https://miro.medium.com/v2/resize:fit:1400/1*w2oGdXv5btEMxAkAsz8fbg.png)\n</details>\n\n```{r}\n#| eval: false\n#| echo: true\nlibrary(doremifasol)\nlibrary(dplyr)\n\nbase_publique_equipements <- telechargerDonnees(\"BPE_ENS\")\nbase_publique_equipements %>%\n  as_tibble() %>% # <1>\n  filter(TYPEQU == \"B316\") %>% # <2>\n  group_by(DEP) %>% # <3>\n  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE))  # <4>\n```\n1. On convertit le _dataframe_ standard en `tibble`\n2. On ne garde que les stations services (valeurs `B316` de `TYPEQU`)\n3. On d√©finit `DEP` comme une variable de stratification pour d√©finir des groupes\n4. On r√©sume les donn√©es en faisant la somme des stations services dans chaque groupe\n\n## `ggplot`\n\n![](https://ggplot2.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ indispensable pour faire des graphiques ‚ù§Ô∏è ;\n- Approche coh√©rente et flexible bas√©e sur la __grammaire des graphiques__\n    + Objet d'un chapitre d√©di√©\n\n## `stringr`, `forcats` et `lubridate`\n\n:::{ncol-layout=3 fig-align=\"center\"}\n![](https://stringr.tidyverse.org/logo.png){width=20%}\n![](https://forcats.tidyverse.org/logo.png){width=20%}\n![](https://lubridate.tidyverse.org/logo.png){width=20%}\n:::\n\n- Plein de fonctions facilitant la manipulation:\n    - Donn√©es textuelles: `stringr`\n    - Donn√©es cat√©gorielles: `forcats`\n    - Donn√©es temporelles: `lubridate`\n\n# Les formats de donn√©es\n\n## G√©n√©ralit√©s\n\n- Donn√©es peuvent √™tre stock√©es dans de nombreux formats diff√©rents\n    + Standards diff√©rents\n    + Mani√®res d'importer diff√©rentes\n\n. . .\n\n- Fonctionnalit√©s de {{< fa brands r-project >}} limit√©es:\n    + Packages sp√©cialis√©s pour certains formats\n    + Objectif: applatir l'information dans un _dataframe_\n\n::: {.callout-note}\nOn verra les formats g√©ographiques, et leurs enjeux, ult√©rieurement\n:::\n\n## Le `CSV`\n\n- Format de fichier plat avec des colonnes d√©limit√©es:\n    + Standard: `,` en d√©limitateur, `.` en d√©cimale ;\n    + Variante europ√©enne üòÆ‚Äçüí®: `;` en d√©limitateur, `,` en d√©cimale\n\n- Format universel, simple d'utilisation (quelques limites)\n\n\n```{ojs}\nviewof info_csv = Inputs.radio(\n  [\"Fichier brut\", \"Ficher apr√®s import\"], {value: \"Fichier brut\"}\n)\n```\n\n```{ojs}\ninfo_csv == \"Fichier brut\" ? html`<div>${md_csv}<div>` : html`<div>${df_csv}<div>`\n```\n\n\n\n```{ojs}\n//| output: false\ndf_csv = Inputs.table(\n  d3.csvParse(raw_csv)\n)\nmd_csv = md`\n\\`\\`\\`\n${raw_csv}\n\\`\\`\\`\n`\n```\n\n```{ojs}\n//| output: false\nraw_csv = `DEP,REG,CHEFLIEU,TNCC,NCC,NCCENR,LIBELLE\n01,84,01053,5,AIN,Ain,Ain\n02,32,02408,5,AISNE,Aisne,Aisne\n03,84,03190,5,ALLIER,Allier,Allier\n04,93,04070,4,ALPES DE HAUTE PROVENCE,Alpes-de-Haute-Provence,Alpes-de-Haute-Provence\n05,93,05061,4,HAUTES ALPES,Hautes-Alpes,Hautes-Alpes\n06,93,06088,4,ALPES MARITIMES,Alpes-Maritimes,Alpes-Maritimes\n`\n```\n\n## Le `CSV`\n\n- Lecture avec la fonction `read_csv` du package `readr`!\n\n```{r}\n#| eval: false\n#| echo: true\nlibrary(readr) # <1>\nread_csv(\"dossier_donnees/nom_fichier.csv\") # <2>\n```\n1. On importe la librairie `readr` pour avoir acc√®s √† la fonction `read_csv`\n2. On utilise `read_csv` pour lire les donn√©es stock√©es dans le chemin relatif\n`dossier_donnees/nom_fichier.csv`\n\n\n:::{.callout-note}\n- CSV avec d√©limitateur `;`: fonction `read_csv2`. \n- Formats plats plus exotiques (`.txt` par exemple): `read_delim`\n\nPlus de d√©tails dans la documentation [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats#importer-un-fichier-avec-le-package-readr)\n:::\n\n## Le `JSON`\n\n- Le format du _web_, notamment des API \n    + API: on verra √ßa plus tard\n\n```{ojs}\nviewof info_json = Inputs.radio(\n  [\"Fichier brut\", \"Ficher apr√®s import\"], {value: \"Fichier brut\"}\n)\n```\n\n```{ojs}\ninfo_json == \"Fichier brut\" ? html`<div>${md_json}<div>` : html`<div>${df_json}<div>`\n```\n\n```{ojs}\n//| output: false\njson_string = `[\n  {\"DEP\": \"01\", \"REG\": \"84\", \"CHEFLIEU\": \"01053\", \"TNCC\": \"5\", \"NCC\": \"AIN\", \"NCCENR\": \"Ain\", \"LIBELLE\": \"Ain\"},\n  {\"DEP\": \"02\", \"REG\": \"32\", \"CHEFLIEU\": \"02408\", \"TNCC\": \"5\", \"NCC\": \"AISNE\", \"NCCENR\": \"Aisne\", \"LIBELLE\": \"Aisne\"},\n  {\"DEP\": \"03\", \"REG\": \"84\", \"CHEFLIEU\": \"03190\", \"TNCC\": \"5\", \"NCC\": \"ALLIER\", \"NCCENR\": \"Allier\", \"LIBELLE\": \"Allier\"},\n  {\"DEP\": \"04\", \"REG\": \"93\", \"CHEFLIEU\": \"04070\", \"TNCC\": \"4\", \"NCC\": \"ALPES DE HAUTE PROVENCE\", \"NCCENR\": \"Alpes-de-Haute-Provence\", \"LIBELLE\": \"Alpes-de-Haute-Provence\"},\n  {\"DEP\": \"05\", \"REG\": \"93\", \"CHEFLIEU\": \"05061\", \"TNCC\": \"4\", \"NCC\": \"HAUTES ALPES\", \"NCCENR\": \"Hautes-Alpes\", \"LIBELLE\": \"Hautes-Alpes\"},\n  {\"DEP\": \"06\", \"REG\": \"93\", \"CHEFLIEU\": \"06088\", \"TNCC\": \"4\", \"NCC\": \"ALPES MARITIMES\", \"NCCENR\": \"Alpes-Maritimes\", \"LIBELLE\": \"Alpes-Maritimes\"}\n]`\nraw_json = [\n  {\"DEP\": \"01\", \"REG\": \"84\", \"CHEFLIEU\": \"01053\", \"TNCC\": \"5\", \"NCC\": \"AIN\", \"NCCENR\": \"Ain\", \"LIBELLE\": \"Ain\"},\n  {\"DEP\": \"02\", \"REG\": \"32\", \"CHEFLIEU\": \"02408\", \"TNCC\": \"5\", \"NCC\": \"AISNE\", \"NCCENR\": \"Aisne\", \"LIBELLE\": \"Aisne\"},\n  {\"DEP\": \"03\", \"REG\": \"84\", \"CHEFLIEU\": \"03190\", \"TNCC\": \"5\", \"NCC\": \"ALLIER\", \"NCCENR\": \"Allier\", \"LIBELLE\": \"Allier\"},\n  {\"DEP\": \"04\", \"REG\": \"93\", \"CHEFLIEU\": \"04070\", \"TNCC\": \"4\", \"NCC\": \"ALPES DE HAUTE PROVENCE\", \"NCCENR\": \"Alpes-de-Haute-Provence\", \"LIBELLE\": \"Alpes-de-Haute-Provence\"},\n  {\"DEP\": \"05\", \"REG\": \"93\", \"CHEFLIEU\": \"05061\", \"TNCC\": \"4\", \"NCC\": \"HAUTES ALPES\", \"NCCENR\": \"Hautes-Alpes\", \"LIBELLE\": \"Hautes-Alpes\"},\n  {\"DEP\": \"06\", \"REG\": \"93\", \"CHEFLIEU\": \"06088\", \"TNCC\": \"4\", \"NCC\": \"ALPES MARITIMES\", \"NCCENR\": \"Alpes-Maritimes\", \"LIBELLE\": \"Alpes-Maritimes\"}\n]\nmd_json = md`\n\\`\\`\\`\n${json_string}\n\\`\\`\\`\n`\n```\n\n```{ojs}\n//| output: false\ndf_json = Inputs.table(raw_json)\n```\n\n## Le `JSON`\n\n- Import√© comme une liste hi√©rarchis√©e\n- Objectif: transformer cette information dans un _dataframe_ `tidy`\n    + Pas toujours √©vident !\n\n```{r}\n#| eval: false\n#| echo: true\nlibrary(jsonlite) # <1>\ndf <- fromJSON(file=\"dossier_donnees/nom_fichier.json\") # <2>\n```\n1. On importe la librairie `jsonlite` pour avoir acc√®s √† la fonction `fromJSON`\n2. On utilise `fromJSON` pour lire les donn√©es stock√©es dans le chemin relatif\n`dossier_donnees/nom_fichier.csv`\n\n\n## Les formats Excel\n\n{{< iconify face-vomiting size=10x >}}\n\n## Les formats Excel\n\n- Format propri√©taire\n\n- M√©lange mise en forme et donn√©es brute\n    + Pas appropri√© pour l'analyse de donn√©es\n    + Dangereux pour la reproductibilit√© et la transparence\n\n- Plus de d√©tails sur [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_tableurs)\n\n# Le _pipe_ `magrittr` (`%>%`)\n\n## Le _pipe_ `magrittr` (`%>%`)\n\n\nUne mani√®re de cha√Æner les op√©rations\n\n![](https://magrittr.tidyverse.org/logo.png){width=20%}\n\n::: {.panel-tabset}\n\n## Fonctions emboit√©es\n\n```\nlibrary(dplyr)\nlibrary(doremifasol)\n\ndf <- filter(\n  as_tibble(telechargerDonnees(\"BPE_ENS\")),\n  TYPEQU == \"B316\"\n)\n\nsummarise(\n  group_by(df, DEP),\n  nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)\n)\n```  \n\n\n## Avec le _pipe_\n\n```\nlibrary(dplyr)\nlibrary(doremifasol)\n\ntelechargerDonnees(\"BPE_ENS\") %>%\n  as_tibble() %>%\n  filter(TYPEQU == \"B316\") %>% \n  group_by(DEP) %>% \n  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)) \n```  \n\n\n:::\n"},"formats":{"onyxia-revealjs":{"identifier":{"display-name":"RevealJS","target-format":"onyxia-revealjs","base-format":"revealjs","extension-name":"onyxia"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":["_extensions/InseeFrLab/onyxia/logo.svg","_extensions/InseeFrLab/onyxia/background.svg","_extensions/InseeFrLab/onyxia/favicon-32x32.png"],"shortcodes":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","filters":["/home/onyxia/work/r-introduction/slides/_extensions/InseeFrLab/onyxia/bg.lua"],"css":["_extensions/InseeFrLab/onyxia/logo.css","custom.css"],"email-obfuscation":"javascript","from":"markdown+emoji","output-file":"wrangling.html"},"language":{"toc-title-document":"Table des mati√®res","toc-title-website":"Sur cette page","related-formats-title":"Autres formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"La source","other-links-title":"Autres liens","code-links-title":"Liens de code","launch-dev-container-title":"Lancer le Dev Container","launch-binder-title":"Lancer le Binder","article-notebook-label":"Cahier d'articles","notebook-preview-download":"T√©l√©charger le cahier","notebook-preview-download-src":"T√©l√©charger le code source","notebook-preview-back":"Retour √† l'article","manuscript-meca-bundle":"Archive MECA","section-title-abstract":"R√©sum√©","section-title-appendices":"Annexes","section-title-footnotes":"Notes de bas de page","section-title-references":"Les r√©f√©rences","section-title-reuse":"R√©utilisation","section-title-copyright":"Droits d'auteur","section-title-citation":"Citation","appendix-attribution-cite-as":"Veuillez citer ce travail comme suit¬†:","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"Voir la Licence","title-block-author-single":"Auteur¬∑rice","title-block-author-plural":"Auteur¬∑rice¬∑s","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Date de publication","title-block-modified":"Modifi√©","title-block-keywords":"Mots cl√©s","callout-tip-title":"Astuce","callout-note-title":"Note","callout-warning-title":"Avertissement","callout-important-title":"Important","callout-caution-title":"Mise en garde","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Montrer tout le code","code-tools-hide-all-code":"Cacher tout le code","code-tools-view-source":"Voir les sources","code-tools-source-code":"Code source","tools-share":"Share","tools-download":"Download","code-line":"Ligne","code-lines":"Lignes","copy-button-tooltip":"Copier vers le presse-papier","copy-button-tooltip-success":"Copi√©","repo-action-links-edit":"Modifier cette page","repo-action-links-source":"Voir la source","repo-action-links-issue":"Faire part d'un probl√®me","back-to-top":"Retour au sommet","search-no-results-text":"Pas de r√©sultats","search-matching-documents-text":"documents trouv√©s","search-copy-link-title":"Copier le lien vers la recherche","search-hide-matches-text":"Cacher les correspondances additionnelles","search-more-match-text":"correspondance de plus dans ce document","search-more-matches-text":"correspondances de plus dans ce document","search-clear-button-title":"Effacer","search-text-placeholder":"","search-detached-cancel-button-title":"Annuler","search-submit-button-title":"Envoyer","search-label":"Recherche","toggle-section":"Basculer la section","toggle-sidebar":"Basculer la barre lat√©rale","toggle-dark-mode":"Basculer le mode sombre","toggle-reader-mode":"Basculer en mode lecteur","toggle-navigation":"Basculer la navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Th√©or√®me","crossref-lem-title":"Lemme","crossref-cor-title":"Corollaire","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"D√©finition","crossref-exm-title":"Exemple","crossref-exr-title":"Exercice","crossref-ch-prefix":"Chapitre","crossref-apx-prefix":"Annexe","crossref-sec-prefix":"Section","crossref-eq-prefix":"√âquation","crossref-lof-title":"Liste des Figures","crossref-lot-title":"Liste des Tables","crossref-lol-title":"Liste des Listings","environment-proof-title":"Preuve","environment-remark-title":"Remarque","environment-solution-title":"Solution","listing-page-order-by":"Trier par","listing-page-order-by-default":"Ordre par d√©faut","listing-page-order-by-date-asc":"Le plus ancien","listing-page-order-by-date-desc":"Le plus r√©cent","listing-page-order-by-number-desc":"Descendant","listing-page-order-by-number-asc":"Ascendant","listing-page-field-date":"Date","listing-page-field-title":"Titre","listing-page-field-description":"Description","listing-page-field-author":"Auteur¬∑rice","listing-page-field-filename":"Nom de fichier","listing-page-field-filemodified":"Modifi√©","listing-page-field-subtitle":"Sous-titre","listing-page-field-readingtime":"Temps de lecture","listing-page-field-wordcount":"Compteur de Mots","listing-page-field-categories":"Cat√©gories","listing-page-minutes-compact":"{0} min.","listing-page-category-all":"Tous","listing-page-no-matches":"Aucun article correspondant","listing-page-words":"{0} mots","listing-page-filter":"Filtre","draft":"Brouillon"},"metadata":{"lang":"fr-FR","fig-responsive":false,"quarto-version":"1.8.27","auto-stretch":true,"theme":["default","_extensions/InseeFrLab/onyxia/onyxia.scss"],"title-slide-attributes":{"data-background-image":"_extensions/InseeFrLab/onyxia/background.svg","data-background-size":"contain"},"header-includes":["<link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"favicon-32x32.png\">\n"],"revealjs-plugins":[],"author":"Lino Galiana","title":"Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}","subtitle":"**[Chapitre 2: manipuler des donn√©es structur√©es]{.orange}**\n","authors":"[Lino Galiana](https://www.linogaliana.fr/),\n","slideNumber":true,"header":"[Retour √† la page principale du cours](https://rgeo.linogaliana.fr/)\n","footer":"Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}, √âcole Normale Sup√©rieure ([retour page principale](/))\n","slide-tone":false,"chalkboard":{"theme":"whiteboard"},"controls":true,"listing":{"id":"sample-listings","contents":"teaching","sort":"date desc","type":"table"}}}},"projectFormats":["html"]}
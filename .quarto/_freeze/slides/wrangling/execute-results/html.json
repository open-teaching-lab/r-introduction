{
  "hash": "56df5174713422f084c012c98d329103",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}\nsubtitle: |\n  **[Chapitre 2: manipuler des donn√©es structur√©es]{.orange}**\nauthors: |\n  [Lino Galiana](https://www.linogaliana.fr/),\n# date: \nslide-number: true\nheader: |\n  [Retour √† la page principale du cours](https://rgeo.linogaliana.fr/)\nfooter: |\n  Introduction aux m√©thodes quantitatives avec {{< fa brands r-project >}}, √âcole Normale Sup√©rieure ([retour page principale](/))\n# uncomment for French presentations:\nlang: fr-FR\n# for blind readers:\nslide-tone: false\n# for @olevitt:\nchalkboard: # press the B key to toggle chalkboard\n  theme: whiteboard\n# uncomment to use the multiplex mode:\n#multiplex: true\nformat:\n  onyxia-revealjs\n  # pick the light mode (onyxia-revealjs) or the dark mode (onyxia-dark-revealjs)\n  #onyxia-dark-revealjs:\ncontrols: true\ncss: custom.css\nfrom: markdown+emoji\nlisting:\n  id: sample-listings\n  contents: teaching\n  sort: \"date desc\"\n  type: table\n#filters:\n#  - reveal-header\n---\n\n## Chapitre introductif\n\n::: {.callout-note}\n- Exercices associ√©s √† ce chapitre [ici](/exercises/r-wrangling.html)\n:::\n\n![](../cards/wrangling/kidmatrix.png){fig-align=\"center\"}\n\n- [Retour √† la page principale](/)\n\n## Introduction\n\n- {{< fa brands r-project >}} centr√© autour du _dataframe_ \n\n. . .\n\n- Mais manipulations parfois un peu lourdes :\n    - `df$var`: un peu lourd\n    - `df[,]`: un peu trop calqu√© sur les matrices\n\n. . . \n\n- Donn√©es textuelles: une base perfectible\n    - Des _outputs_ alambiqu√©s\n    - Des fonctionnalit√©s manquantes par rapport √† `Python`\n    \n## La r√©ponse: le `tidyverse` !\n\n![L'√©cosyst√®me du [`tidyverse`](https://www.tidyverse.org/)](./img/tidyverse.png)\n\n## La r√©ponse: le `tidyverse` !\n\nUn ensemble de _packages_ d√©velopp√©s par `RStudio` qui facilite :\n\n- La lecture (`readr`) et la manipulation de bases de donn√©es (`dplyr`)\n- L'exploitation de donn√©es textuelles (`stringr`), temporelles (`lubridate`)\nou cat√©gorielles (`forcats`)\n- La cr√©ation de graphiques (`ggplot2`)\n- La programmation √† partir de _dataframes_ (`purrr`)\n- Et bien d'autres choses...\n\n## Le concept de donn√©es _tidy_\n\n\n- Chaque variable poss√®de sa propre colonne ;\n- Chaque observation poss√®de sa propre ligne ;\n- Une valeur, mat√©rialisant une observation d‚Äôune variable, se trouve sur une unique cellule.\n\n::: {.callout-note}\nConcept popularis√© par Hadley Wickham.\n:::\n\n## `readr`\n\n![](https://readr.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ pour lire des fichiers plats (`.csv`, `.txt`...)\n- Permet d'obtenir un `tibble`, le _dataframe_ augment√© du `tidyverse`\n\n## `dplyr` \n\n![](https://dplyr.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ central de l'√©cosyst√®me de manipulation de donn√©es ;\n- Manipulation de donn√©es et statistiques descriptives ;\n\n## `dplyr` {.smaller}\n\n### Principaux verbes\n\nOn travaille sur un `tibble` (_dataframe_ augment√©)\n\n- `select()` : s√©lectionner des variables par leur nom ;\n- `rename()` : renommer des variables ;\n- `filter()` : s√©lectionner des observations selon une ou plusieurs conditions ;\n- `arrange()` : trier la table selon une ou plusieurs variables ;\n- `mutate()` : ajouter des variables qui sont fonction d‚Äôautres variables ;\n- `summarise()` : calculer une statistique √† partir de donn√©es ;\n- `group_by()` : faire des op√©rations par groupe.- `\n\n\n\n## `dplyr` {.smaller}\n\n### Manipulation de donn√©es\n\nOn enchaine des s√©quences avec les  _pipe_ (`%>%`)\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(doremifasol)\nlibrary(dplyr)\n\nbase_publique_equipements <- telechargerDonnees(\"BPE_ENS\")\nbase_publique_equipements %>%\n  as_tibble() %>% # <1>\n  filter(TYPEQU == \"B316\") %>% # <2>\n  mutate(x = paste0(AN, \"_\", NB_EQUIP)) # <3>\n```\n:::\n\n1. On convertit le _dataframe_ standard en `tibble`\n2. On ne garde que les stations services (valeurs `B316` de `TYPEQU`)\n3. On cr√©e une nouvelle colonne en faisant r√©f√©rence √† celles existantes (sans guillemets!)\n\n<br>\n\n::: {.callout-note}\nPlus de d√©tails dans [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_tidyverse)\n:::\n\n## `dplyr` {.smaller}\n\n### Statistiques agr√©g√©es\n\n- Logique du _split-apply-combine_ avec `groupby`\n\n<details>\n<summary>\nIllustration du _split-apply-combine_\n</summary>\n![](https://miro.medium.com/v2/resize:fit:1400/1*w2oGdXv5btEMxAkAsz8fbg.png)\n</details>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(doremifasol)\nlibrary(dplyr)\n\nbase_publique_equipements <- telechargerDonnees(\"BPE_ENS\")\nbase_publique_equipements %>%\n  as_tibble() %>% # <1>\n  filter(TYPEQU == \"B316\") %>% # <2>\n  group_by(DEP) %>% # <3>\n  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE))  # <4>\n```\n:::\n\n1. On convertit le _dataframe_ standard en `tibble`\n2. On ne garde que les stations services (valeurs `B316` de `TYPEQU`)\n3. On d√©finit `DEP` comme une variable de stratification pour d√©finir des groupes\n4. On r√©sume les donn√©es en faisant la somme des stations services dans chaque groupe\n\n## `ggplot`\n\n![](https://ggplot2.tidyverse.org/logo.png){width=20%}\n\n- Le _package_ indispensable pour faire des graphiques ‚ù§Ô∏è ;\n- Approche coh√©rente et flexible bas√©e sur la __grammaire des graphiques__\n    + Objet d'un chapitre d√©di√©\n\n## `stringr`, `forcats` et `lubridate`\n\n:::{ncol-layout=3 fig-align=\"center\"}\n![](https://stringr.tidyverse.org/logo.png){width=20%}\n![](https://forcats.tidyverse.org/logo.png){width=20%}\n![](https://lubridate.tidyverse.org/logo.png){width=20%}\n:::\n\n- Plein de fonctions facilitant la manipulation:\n    - Donn√©es textuelles: `stringr`\n    - Donn√©es cat√©gorielles: `forcats`\n    - Donn√©es temporelles: `lubridate`\n\n# Les formats de donn√©es\n\n## G√©n√©ralit√©s\n\n- Donn√©es peuvent √™tre stock√©es dans de nombreux formats diff√©rents\n    + Standards diff√©rents\n    + Mani√®res d'importer diff√©rentes\n\n. . .\n\n- Fonctionnalit√©s de {{< fa brands r-project >}} limit√©es:\n    + Packages sp√©cialis√©s pour certains formats\n    + Objectif: applatir l'information dans un _dataframe_\n\n::: {.callout-note}\nOn verra les formats g√©ographiques, et leurs enjeux, ult√©rieurement\n:::\n\n## Le `CSV`\n\n- Format de fichier plat avec des colonnes d√©limit√©es:\n    + Standard: `,` en d√©limitateur, `.` en d√©cimale ;\n    + Variante europ√©enne üòÆ‚Äçüí®: `;` en d√©limitateur, `,` en d√©cimale\n\n- Format universel, simple d'utilisation (quelques limites)\n\n\n```{ojs}\nviewof info_csv = Inputs.radio(\n  [\"Fichier brut\", \"Ficher apr√®s import\"], {value: \"Fichier brut\"}\n)\n```\n\n```{ojs}\ninfo_csv == \"Fichier brut\" ? html`<div>${md_csv}<div>` : html`<div>${df_csv}<div>`\n```\n\n\n\n```{ojs}\n//| output: false\ndf_csv = Inputs.table(\n  d3.csvParse(raw_csv)\n)\nmd_csv = md`\n\\`\\`\\`\n${raw_csv}\n\\`\\`\\`\n`\n```\n\n```{ojs}\n//| output: false\nraw_csv = `DEP,REG,CHEFLIEU,TNCC,NCC,NCCENR,LIBELLE\n01,84,01053,5,AIN,Ain,Ain\n02,32,02408,5,AISNE,Aisne,Aisne\n03,84,03190,5,ALLIER,Allier,Allier\n04,93,04070,4,ALPES DE HAUTE PROVENCE,Alpes-de-Haute-Provence,Alpes-de-Haute-Provence\n05,93,05061,4,HAUTES ALPES,Hautes-Alpes,Hautes-Alpes\n06,93,06088,4,ALPES MARITIMES,Alpes-Maritimes,Alpes-Maritimes\n`\n```\n\n## Le `CSV`\n\n- Lecture avec la fonction `read_csv` du package `readr`!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr) # <1>\nread_csv(\"dossier_donnees/nom_fichier.csv\") # <2>\n```\n:::\n\n1. On importe la librairie `readr` pour avoir acc√®s √† la fonction `read_csv`\n2. On utilise `read_csv` pour lire les donn√©es stock√©es dans le chemin relatif\n`dossier_donnees/nom_fichier.csv`\n\n\n:::{.callout-note}\n- CSV avec d√©limitateur `;`: fonction `read_csv2`. \n- Formats plats plus exotiques (`.txt` par exemple): `read_delim`\n\nPlus de d√©tails dans la documentation [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats#importer-un-fichier-avec-le-package-readr)\n:::\n\n## Le `JSON`\n\n- Le format du _web_, notamment des API \n    + API: on verra √ßa plus tard\n\n```{ojs}\nviewof info_json = Inputs.radio(\n  [\"Fichier brut\", \"Ficher apr√®s import\"], {value: \"Fichier brut\"}\n)\n```\n\n```{ojs}\ninfo_json == \"Fichier brut\" ? html`<div>${md_json}<div>` : html`<div>${df_json}<div>`\n```\n\n```{ojs}\n//| output: false\njson_string = `[\n  {\"DEP\": \"01\", \"REG\": \"84\", \"CHEFLIEU\": \"01053\", \"TNCC\": \"5\", \"NCC\": \"AIN\", \"NCCENR\": \"Ain\", \"LIBELLE\": \"Ain\"},\n  {\"DEP\": \"02\", \"REG\": \"32\", \"CHEFLIEU\": \"02408\", \"TNCC\": \"5\", \"NCC\": \"AISNE\", \"NCCENR\": \"Aisne\", \"LIBELLE\": \"Aisne\"},\n  {\"DEP\": \"03\", \"REG\": \"84\", \"CHEFLIEU\": \"03190\", \"TNCC\": \"5\", \"NCC\": \"ALLIER\", \"NCCENR\": \"Allier\", \"LIBELLE\": \"Allier\"},\n  {\"DEP\": \"04\", \"REG\": \"93\", \"CHEFLIEU\": \"04070\", \"TNCC\": \"4\", \"NCC\": \"ALPES DE HAUTE PROVENCE\", \"NCCENR\": \"Alpes-de-Haute-Provence\", \"LIBELLE\": \"Alpes-de-Haute-Provence\"},\n  {\"DEP\": \"05\", \"REG\": \"93\", \"CHEFLIEU\": \"05061\", \"TNCC\": \"4\", \"NCC\": \"HAUTES ALPES\", \"NCCENR\": \"Hautes-Alpes\", \"LIBELLE\": \"Hautes-Alpes\"},\n  {\"DEP\": \"06\", \"REG\": \"93\", \"CHEFLIEU\": \"06088\", \"TNCC\": \"4\", \"NCC\": \"ALPES MARITIMES\", \"NCCENR\": \"Alpes-Maritimes\", \"LIBELLE\": \"Alpes-Maritimes\"}\n]`\nraw_json = [\n  {\"DEP\": \"01\", \"REG\": \"84\", \"CHEFLIEU\": \"01053\", \"TNCC\": \"5\", \"NCC\": \"AIN\", \"NCCENR\": \"Ain\", \"LIBELLE\": \"Ain\"},\n  {\"DEP\": \"02\", \"REG\": \"32\", \"CHEFLIEU\": \"02408\", \"TNCC\": \"5\", \"NCC\": \"AISNE\", \"NCCENR\": \"Aisne\", \"LIBELLE\": \"Aisne\"},\n  {\"DEP\": \"03\", \"REG\": \"84\", \"CHEFLIEU\": \"03190\", \"TNCC\": \"5\", \"NCC\": \"ALLIER\", \"NCCENR\": \"Allier\", \"LIBELLE\": \"Allier\"},\n  {\"DEP\": \"04\", \"REG\": \"93\", \"CHEFLIEU\": \"04070\", \"TNCC\": \"4\", \"NCC\": \"ALPES DE HAUTE PROVENCE\", \"NCCENR\": \"Alpes-de-Haute-Provence\", \"LIBELLE\": \"Alpes-de-Haute-Provence\"},\n  {\"DEP\": \"05\", \"REG\": \"93\", \"CHEFLIEU\": \"05061\", \"TNCC\": \"4\", \"NCC\": \"HAUTES ALPES\", \"NCCENR\": \"Hautes-Alpes\", \"LIBELLE\": \"Hautes-Alpes\"},\n  {\"DEP\": \"06\", \"REG\": \"93\", \"CHEFLIEU\": \"06088\", \"TNCC\": \"4\", \"NCC\": \"ALPES MARITIMES\", \"NCCENR\": \"Alpes-Maritimes\", \"LIBELLE\": \"Alpes-Maritimes\"}\n]\nmd_json = md`\n\\`\\`\\`\n${json_string}\n\\`\\`\\`\n`\n```\n\n```{ojs}\n//| output: false\ndf_json = Inputs.table(raw_json)\n```\n\n## Le `JSON`\n\n- Import√© comme une liste hi√©rarchis√©e\n- Objectif: transformer cette information dans un _dataframe_ `tidy`\n    + Pas toujours √©vident !\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(jsonlite) # <1>\ndf <- fromJSON(file=\"dossier_donnees/nom_fichier.json\") # <2>\n```\n:::\n\n1. On importe la librairie `jsonlite` pour avoir acc√®s √† la fonction `fromJSON`\n2. On utilise `fromJSON` pour lire les donn√©es stock√©es dans le chemin relatif\n`dossier_donnees/nom_fichier.csv`\n\n\n## Les formats Excel\n\n{{< iconify face-vomiting size=10x >}}\n\n## Les formats Excel\n\n- Format propri√©taire\n\n- M√©lange mise en forme et donn√©es brute\n    + Pas appropri√© pour l'analyse de donn√©es\n    + Dangereux pour la reproductibilit√© et la transparence\n\n- Plus de d√©tails sur [`utilitR`](https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_tableurs)\n\n# Le _pipe_ `magrittr` (`%>%`)\n\n## Le _pipe_ `magrittr` (`%>%`)\n\n\nUne mani√®re de cha√Æner les op√©rations\n\n![](https://magrittr.tidyverse.org/logo.png){width=20%}\n\n::: {.panel-tabset}\n\n## Fonctions emboit√©es\n\n```\nlibrary(dplyr)\nlibrary(doremifasol)\n\ndf <- filter(\n  as_tibble(telechargerDonnees(\"BPE_ENS\")),\n  TYPEQU == \"B316\"\n)\n\nsummarise(\n  group_by(df, DEP),\n  nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)\n)\n```  \n\n\n## Avec le _pipe_\n\n```\nlibrary(dplyr)\nlibrary(doremifasol)\n\ntelechargerDonnees(\"BPE_ENS\") %>%\n  as_tibble() %>%\n  filter(TYPEQU == \"B316\") %>% \n  group_by(DEP) %>% \n  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)) \n```  \n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
---
title: Introduction to Quantitative Methods with {{< fa brands r-project >}}
subtitle: |
  **[Chapter 3: Representing Data with `ggplot2`]{.orange}**
authors: |
  [Lino Galiana](https://www.linogaliana.fr/),
# date: 
slide-number: true
header: |
  [Back to the course main page](https://rgeo.linogaliana.fr/)
footer: |
  Introduction to Quantitative Methods with {{< fa brands r-project >}}, École Normale Supérieure ([back to main page](/))
# uncomment for French presentations:
lang: en-US
# for blind readers:
slide-tone: false
# for @olevitt:
chalkboard: # press the B key to toggle chalkboard
  theme: whiteboard
# uncomment to use the multiplex mode:
#multiplex: true
format:
  onyxia-revealjs
  # pick the light mode (onyxia-revealjs) or the dark mode (onyxia-dark-revealjs)
  #onyxia-dark-revealjs:
controls: true
css: custom.css
from: markdown+emoji
listing:
  id: sample-listings
  contents: teaching
  sort: "date desc"
  type: table
#filters:
#  - reveal-header
---

## Introduction

::: {.callout-note}
- Exercises associated with this chapter [here](/exercises/r-wrangling.html)
:::

![](../cards/ggplot/drawing.png){fig-align="center"}

- [Back to the main page](/)

## Introduction

- Data visualization synthesizes data structure
    + Guides further data exploration
    + Conveys a message to the reader
    
. . .

- 2 types of visualizations:
    + Static representations: `ggplot2`
    + HTML representations: `leaflet`

## Example dataset
```{r}
#| output: false
#| echo: true
library(doremifasol)
library(dplyr)
library(ggplot2)
library(scales)

df <- telechargerDonnees("FILOSOFI_DISP_IRIS", date = 2017) %>%
  as_tibble() %>%
  sample_frac(0.1)
```

::: {.callout-note}
Inspiration for these slides:

- Collaborative documentation [`utilitR`](https://www.book.utilitr.org/);
- [`ggplot` manual](https://ggplot2-book.org);
- Course by [Joseph Larmarange](https://larmarange.github.io/guide-R/analyses/ggplot2.html)
:::

## `ggplot2`

__Initialize a figure associated with a dataset__
```{r}
#| echo: true
#| code-line-numbers: "1"
ggplot(df, aes(x = DISP_MED17, y = DISP_D917))
```

## `ggplot2`

__Add layers (`+`) with `geom_*` functions__
```{r}
#| echo: true
#| code-line-numbers: "2"
ggplot(df) +
  geom_point(aes(x = DISP_MED17, y = DISP_D917))
```

## `ggplot2` {.smaller}

__Parameterize layers with `aes`__
```{r}
#| echo: true
#| code-line-numbers: "2-3"
ggplot(df) +
  geom_point(aes(x = DISP_MED17, y = DISP_D917, color = DISP_Q117), shape = 3)
```

::: {.callout-note}
Aesthetic control of a `geom_` layer is done through:

- `aes`: variable parameters of the layer linked to a variable;
- outside `aes`: parameters that apply uniformly to the layer
:::

## `ggplot2`

__Add layers (`+`) with `geom_*` functions__
```{r}
#| echo: true
#| code-line-numbers: "3"
ggplot(df, aes(x = DISP_MED17, y = DISP_D917)) +
  geom_point(aes(color = DISP_Q117), shape = 3) +
  geom_smooth(color = "red", alpha = 0.7, se = FALSE)
```

## `ggplot2` {.smaller}

__Modify scales with `scale_` functions__
```{r}
#| echo: true
#| code-line-numbers: "4-6"
ggplot(df, aes(x = DISP_MED17, y = DISP_D917)) +
  geom_point(aes(color = DISP_Q117), shape = 3) +
  geom_smooth(color = "red", alpha = 0.7, se = FALSE) +
  scale_x_continuous(labels = unit_format(unit = "k", scale=1e-3)) +
  scale_y_continuous(trans='log', labels = unit_format(unit = "k", scale=1e-3)) +
  scale_color_viridis_c()
```

## `ggplot2` {.smaller}

__Modify scales with `scale_` functions__
```{r}
#| echo: true
#| code-line-numbers: "5-7"
df <- df %>% mutate(quartile = factor(ntile(DISP_Q117, 4)))
ggplot(df, aes(x = DISP_MED17, y = DISP_D917)) +
  geom_point(aes(color = quartile), shape = 3) +
  geom_smooth(color = "red", alpha = 0.7, se = FALSE) +
  scale_x_continuous(labels = unit_format(unit = "k", scale=1e-3)) +
  scale_y_continuous(trans='log', labels = unit_format(unit = "k", scale=1e-3)) +
  scale_color_viridis_d(option = "turbo")
```

## `ggplot2` {.smaller}

__Modify aesthetics, only at the end__
```{r}
#| echo: true
#| code-line-numbers: "8-10"
p <- ggplot(df, aes(x = DISP_MED17, y = DISP_D917)) +
  geom_point(aes(color = quartile), shape = 3) +
  geom_smooth(color = "red", alpha = 0.7, se = FALSE) +
  scale_x_continuous(labels = unit_format(unit = "k", scale=1e-3)) +
  scale_y_continuous(trans='log', labels = unit_format(unit = "k", scale=1e-3)) +
  scale_color_viridis_d(option = "turbo")

p + theme_bw() +
  labs(x = "Median income", y = "9th decile", color = "Quartile") +
  theme(legend.position = "bottom")
```
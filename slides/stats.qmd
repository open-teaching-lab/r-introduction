---
title: Introduction to quantitative methods with {{< fa brands r-project >}}
subtitle: |
  **[Chapter 3: Describe and infer data]{.orange}**
authors: |
  [Nathan Randriamanana](https://www.linkedin.com/in/nathan-randriamanana-69a1721b3/),
  [Clara Baudry](https://www.linkedin.com/in/clara-baudry/),
# date: 
slide-number: true
header: |
  [Back to the course main page](https://rgeo.linogaliana.fr/)
footer: |
  Introduction to quantitative methods with {{< fa brands r-project >}}, Lesotho Bureau of Statistics ([back to main page](/))
# uncomment for French presentations:
lang: en-US
# for blind readers:
slide-tone: false
# for @olevitt:
chalkboard: # press the B key to toggle chalkboard
  theme: whiteboard
# uncomment to use the multiplex mode:
#multiplex: true
format:
  onyxia-revealjs
  # pick the light mode (onyxia-revealjs) or the dark mode (onyxia-dark-revealjs)
  #onyxia-dark-revealjs:
controls: true
css: custom.css
from: markdown+emoji
listing:
  id: sample-listings
  contents: teaching
  sort: "date desc"
  type: table
#filters:
#  - reveal-header
---

## Introductory Chapter

::: {.callout-note}
- Exercises associated with this chapter [here](/exercises/stats.html)
:::

![](../cards/stats/teacher_stats.png){fig-align="center"}

- [Back to the main page](/)

## The Logic of Data Aggregation

* **Concept**: The "Split-Apply-Combine" paradigm.
* **`group_by()`**: Partitions the dataset into logical subsets.
* **`summarise()`**: Applies a function to each subset to return a single value.
* **`across()`**: Scales the operation to multiple columns at once.

## Practical Aggregation

```{r}
#| echo: true
#| eval: false
library(dplyr)

# Standard descriptive pipeline
data %>%
  group_by(category) %>%
  summarise(
    n = n(),
    across(c(income, age), list(avg = ~mean(.x, na.rm = TRUE), med = ~median(.x, na.rm = TRUE)))
  )
```

The Specificity of Survey Data

    {{< fa scale-balanced >}} Sampling Weights: Essential to restore the representativeness of the target population.

    The Bias Risk: Standard arithmetic functions (mean, sd) assume equal probability. On weighted data, they produce scientifically biased results.

    Horvitz-Thompson: Every observation i must be weighted by wi​=1/πi​.

Point Estimates with Hmisc

    Optimized for quick weighted statistics within dplyr.

    Key functions: wtd.mean(), wtd.var(), wtd.quantile().

```{r}
#| echo: true
#| eval: false
library(Hmisc)

# Weighted summary
data %>%
  group_by(education_level) %>%
  summarise(
    weighted_avg = wtd.mean(income, weights = weight_var),
    weighted_med = wtd.quantile(income, weights = weight_var, probs = 0.5)
  )
```

Inference with the survey Package

    Complex Designs: Takes into account strata and clusters.

    Variance: Computes correct Standard Errors (SE) adjusted for the design effect.

```{r}
#| echo: true
#| eval: false
library(survey)

# 1. Define the design object
design <- svydesign(
  ids = ~cluster_id, 
  strata = ~strata_id, 
  weights = ~sampling_weight, 
  data = data, 
  nest = TRUE
)

# 2. Estimate with precision
svymean(~income, design = design)
svyquantile(~income, design = design, quantiles = 0.5)
```

Hypothesis Testing & P-values

    {{< fa chart-line >}} Comparison: Testing if differences between sub-groups are real or due to sampling noise.

    Design-Adjusted Tests: standard t-tests or χ2 will underestimate variance.

```{r}
#| echo: true
#| eval: false
# Weighted T-test for group differences
test_res <- svyttest(income ~ gender, design = design)
print(test_res)

# Interpretation:
# p-value < 0.05 => Reject H0 (Significant difference)
# p-value > 0.05 => Fail to reject H0 (No significant difference)
```

Advanced Modeling: svyglm()

    Allows for Linear and Logistic regressions on survey data.

    Adjusts the variance-covariance matrix.

    Ensures that coefficient p-values and confidence intervals are valid under complex sampling.

```{r}
#| echo: true
#| eval: false
# Weighted Logistic Regression
model <- svyglm(employed ~ age + education, design = design, family = quasibinomial())
summary(model)
```

| Goal | Library | Method |
|:---|:---:|:---|
| **Exploration** | `dplyr` | `group_by()` + `summarise()` |
| **Weighted Point** | `Hmisc` | `wtd.mean()`, `wtd.quantile()` |
| **Inference & Tests** | `survey` | `svydesign()` + `svyttest()` |
| **P-values & Modeling** | `survey` | `svyglm()` |

::: {.callout-important}
### Note

A statistician's duty is to report the Confidence Interval. A point estimate without its measure of uncertainty is incomplete.
:::